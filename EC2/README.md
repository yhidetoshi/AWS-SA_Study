# EC2

**インスタンスファミリー**

- 汎用(M3,M4) 
   　- 常用途に適したバランスのコンピューティング・メモリ・ネットワーク性能
- バーストパフォーマンス(T2) 
     - 普段は殆ど負荷が無いか、一時的に負荷がある開発機、小規模システムなど
- コンピューティング最適化 (C3, C4)
     - CPU性能が必要な用途向け：APサーバ、HPC 画像処理
- メモリ最適化(R3) 
     - コアあたりのメモリが大きく、大量のメモリが必要な用途向け、(DBサーバ)
- 高I/Oストレージ(I2)　
     - 高速なIOPSを実現するSSDを内蔵
- 高密度ストレージ(D2)
     - 大容量HDDを内蔵(DBサーバ、DWH、ビックデータ)
- GPUコアが必要な用途向け(グラフィック表示、画像処理)

**ペネトレーションテスト**

- 適正利用委規約により、侵入テストやりリソースのスキャンは禁止されている
　　- AWS脆弱性/侵入テストリクエストフォームでテスト内容の申請が必要
**SMTP送信**

- EC2からSMTP送信するトラフィックは制限されている　
　→　申請フォームによる申請が必要です。
 
 **AWS Trusted Advisorによるチェック**
 
 - 不要リソースやアイドル状態のリソースを検出
 - リザーブドインスタンスの利用状況を可視化
 - チェック項目
   - セキュリティグループの無制限公開ポート
   - セキュリティグループの無制限アクセスチェック

**CloudWatchができること**

- 標準モニタリング　
  - 各種 メトリクスをデフォルトで取得
- 詳細モニタリング
  - 標準では5分間隔でモニタリング
  - 詳細モニタリングを有効化すると1分間ごとのデータ取得が可能
  - 3.5ドル（毎月インスタンスあたり）
  
- Auto Recovery
  - アラーム発砲時に自動的にインスタンス再起動を行う
- EC2の可用性は99.95%

**ストレージ**

- Amazon Machine Image(AMI)から見たストレージ分類
 - EBS-Backed-AMI
  - EC2停止、終了のオプションあり
  - 停止しても、ファイルシステムは永続する
 - Instance Store Backed AMI
  - EC2に停止するオプションはない
  - EC2を終了するとデータは消える
  
- Root DeviceがInstance Storeであるかをの確認方法
 - EC2の場合
  - Describe -> Root Device Typeを確認。Instance Storeと表示
  - AMIの場合
   - AMI選択一覧のRoot Device Typeを確認。Instance storeと表示
   
- Instance Storeとは
 - EC2の物理筐体のローカルディスク
 - インスタンスタイプにより、サイズと、個数、HDD/SSDが予め決まっている
 - インスタンス停止するとデータは消去される
 - スナップショット機能はない
 - 別のEC2に付け替えができない
 
- Instance StoreとアーキテクチャとEphemeral Disk
 - Instance Storeは各EC2インスタンスと同じ物理ホストに存在
 - ディスク名をEphemeral Disk(Instance Store Volume)と呼ぶ
 - 物理ホストに割り当てされているが、利用できるのは特定の１つのEC2インスタンスのみ
  - 同じ物理ホストの別EC2から共有は不可 

- Instance Storeを共有ディスク構成で利用する場合の制約
 - 複数のEC2インスタンスから同時に一つのInstance Storeをアタッチできない
 - 1つのEC2インスタンスから複数のEBSのアタッチは可能
 - 共有ディスク型のクラスタソフトやOracle RACといったソリューションをそのまま利用できない
 - Instance Storeは別のEC2に付け替えもできない

- EC2に接続するEphemeral Disk数の変更‘
 - EC2インスタンスを起動後はInstance Storeの変更はできないため、再度AMIから起動時に選択する必要がある
 - Instance Storeのサイズは、予めEC2インスタンスによって決まっているためサイズ変更ができない
  - 例えば、m1.largeでは、420GのEpheral Diskが２つまでと決められている
   - 2つのディスクをストライプして840GとしてOSから1ドライブで利用する
   - 確認方法: `curl meta-data/block-device-mappinng`
  
- Swap領域としての活用
 - AWSは物理環境を意識しないため、メモリのオーバーコミットができないため、メモリ超過はスワップ領域で回避できる
 
- Instance StoreのAMI化
 - Create ImageでAMI作成時のボリュームでInstance Storeを選択することでAMIのデバイスにInstance Storeがマッピングされる
  - EBSとは違い、データは保持されない
