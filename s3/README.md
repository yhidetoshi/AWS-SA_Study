# s3


**s3 (Simple Storage Service)**

- 1ファイルの最大は5TB

**[タイプ]**
- スタンダード 
- 標準低頻度アクセスストレージ 
- 低冗長化ストレージ 
- アーカイブ(Glacier)

**[オペレーション]**
- 新規登録：登録後、即時データ参照ができる
- 更新　：更新直後は以前のデータを参照する可能性がある
- 削除　：削除直後は以前のデータを参照する可能性がある
※ 重複書き込み制御のため、ロック処理をせずにタイムスタンプが更新される

**[操作]**
- GET / PUT
- LIST 最大1000個の一覧を取得可能 
- COPY シングルアップロードでは5GB マルチアップロードでは5TBが可能 
- DELETE 最大1000個のオブジェクトを削除可能　MFA連携可能 
- RESTORE (アーカイブのGlacierから低冗長化ストレージに期間指定でコピーしダウンロード可能)

- 大容量オブジェクトの高速転送機能
  - ファイルを複数のチャンクに分割して並列アップロードが可能 ファイルが100MB以上だと推奨。

**[アクセス管理]**
- ユーザポリシー
 - IAMユーザに対してs3やバケットへの権限を設定可能
 - 複数バケットやs3以外のものを含めて一元的に管理可能
 - IAMユーザに任意のバケットにアクセス権限を付与 / Condition要素を利用して接続元IPを指定することが可能

- バケットポリシー
 - s3バケット毎にアクセス権限を指定
 - クロスアカウントでs3のバケットアクセス権を付与する場合
 - すべてのユーザに対して任意のバケットへの権限を付与できる　任意のアドレスレンジからの接続許可も可能
    - IAMユーザ、クロスアカウント、HTTP refer、CloudFront、MFA制限が可能

- ACL
 - 各バケットおよびオブジェクトのアクセス権限を指定
 - バケット単位やオブジェクト単位に簡易の権限を設定可能
  - バケット単位のACLとオブジェクト単位のACLが存在する
   - バケットとオブジェクトにACLが存在する場合、オブジェクトのACLが優先される
   - ACLよりもユーザポリシーやバケットポリシーが優先される
   - ACLはバケットやオブジェクトに対して100個まで指定可能

- VPC EndPoint(New)
 - VPC内のPrivate Subnet上で稼働するサービスからNATGatewayやNATインスタンスを経由せずにs3と直接セキュアに接続できる

**[暗号化によるデータの保護]**
- サーバサイド暗号化
  -> AWSのサーバリソースを利用して格納データの暗号化処理を実施
    (種類) -> SSE-S3 (AWSが管理する鍵を利用) / SSE-KMS(AWS KMSを利用した鍵を利用) / SSE-C(ユーザが指定した鍵を利用) 

- クライアントサイド暗号化
 - クライアント側で暗号化したデーアをアップロード
　　(種類) -> AWS KMSを利用、クライアント管理の鍵を利用

- 署名付きURL (pre-signed Object URL)
  - Pre signed URLでセキュアにs3とデータのやり取りをする


 **[Webサイトのホスティング機能]**

 - 静的なウェブサイトをs3のみでホスティング可能
   - バケット単位で指定　(パブリックアクセスを許可するために、別途バケットポリシーで全ユーザにGET権限を付与する)
 - 独自ドメインの指定
   - ドメイン名をバケット名として指定
   - 通常は、http://バケット名.s3-website-ap-northeast-1.amazon.com
   - Route53のエイリアスの指定でドメイン名とs3のバケット名を紐付けたレコードを登録する
 - リダイレクト機能
   - 任意のドメインへリダイレクト設定が可能 

 - CROS(Cross-origin Resource Sharing)の設定
   - Ajaxなどを利用して、異なるドメインからs3へのアクセス時に利用
 - CroudFrontとの連携
   - バケットポリシーを利用してCloudFrontからのHTTP/HTTPSリクエストのみを許可する事も可能
   - webサーバとしてs3を利用するときはCloudFront経由で配信することを推奨

**[バージョン管理]**
- オブジェクト更新時に前世代オブジェクトを自動的に保管
  - バケット全体、もしくはPrefixに対して設定
  - ライフサイクルと連携し保存世代数を設定可能 
  - バージョニングにより保管されているオブジェクトも課金
  - バージョン保管されている任意のオブジェクトを参照可能




