# Route53

**[ルーティングポリシー]**

- シンプルルーティング
  - レコードセットで事前に設定された値のみに基づいてDNSクエリに応答する
  - 従来のDNSと同様に、静的なマッピングによりルーティングが決定される
  
- 加重ルーティンング
  - 複数のエンドポイント毎に設定された重みづけに基づいて、DNSクエリに応答する
  - より重み付けの高いエンドポイントのリソースにより多くルーティングされる
  
- レイテンシールーティング
  - AWSリージョンと遅延によってDNSクエリに応答する
  - リージョン間の遅延が少ない方のリソースへルーティングされる

- フェイルオーバールーティング
  - ヘルスチェックの結果に基づいて、利用可能なリソースをDNSクエリに応答する
  -　利用可能なリソースにのみルーティングされる

- 位置情報ルーティング
  - クライアントの位置情報に基づいて、DNSクエリに応答する
  - 特定の地域・国からのDNSクエリに対して、特定のアドレスを応答する
  
**加重ルーティング**

- 同じ名前、種類のレコードセットに重みをつけて、ルーティング先の頻度を決定する
- ユースケース
  - 段階的な移行 / サーバ毎に性能の偏りがある場合
- 設定
  - Weight: 0 - 255の間で設定可能
  - Set ID: 同一名・タイプ・ルーティングポリシーのレコードを区別
 
**レイテンシールーティング** 

- クライアントからAWSリージョンへのレイテンシーが最小のエンドポイントを選択
- エンドポイントとして、EC2インスタンス・ELBをサポート
- ヘルスチェックとの組み合わせが可能

**フェイルオーバールーティング**

- フェイルオーバールーティング
  - 複数のエンドポイントで、アクティブ、パッシブフェイルオーバを設定
  - 必ずヘルスチェックと組み合わせて使用
  - 複数のリージョンにまたがるシステムで冗長構成
  - 災害発生時にリージョン間でフェイルオーバー
  -　　サイト障害時に、s３静的ウェブサイトホスティングのSorryページを表示
 
 
**DNSフェイルオーバとは**

- ヘルスチェックによりエンドポイントのリソースの正常性をチェックし、正常な場合のみルーティングされるようにDNSクエリに応答
- ヘルスチェック間隔は30秒、または10秒から選択可能
- 設定
  - ヘルスチェック設定
    - 名前 / 監視対象
    - エンドポイントのモニタリング設定(IPアドレス or DNS名)
    - プロトコル: HTTP / HTTPS / TCP
    - IP / ホスト名 / ポート
    - path
  - CloudWathcアラーム作成　-> SNS連携

- ヘルスチェックグラフ
  - レイテンシーグラフを作成可能
  - ヘルスチェッカーからのモニタリングバケットが到達できるようにセキュリティグループを許可する必要あり
  
- 注意点
  - 正常なエンドポイントが存在しない場合は逆に全てのエンドポイントを正常とみなしてDNSクエリに応答する

**トラフィックフロー**

- トラフィックフローとは
  - Route53で、ポリシーベールのトラッフィクルーティングをビジュアルに簡単に作成・管理できる
  - 複雑なルーティングポリシーを組み合わせたルールを、抽象的なレベルで管理できる
  - マルチリージョンアーキテクチャで、高可用性、低レイテンシーで、複雑なポリシーを提供する必要がある大規模システムの
  設計・運用でメリットが大きい
 
  - 使わない場合
    - ALIASレコードを駆使して、複雑なルーティングポリシーを作成していた
  - 使った場合
    - 複雑な条件を組み合わせたルーティングをエディタでビジュアルに作成することができる
    
**IAMによるRoute53へのアクセス制限**

- IAMによりドメイン、ホストゾーン、リソースレコードの作成を制御可能
- CloudTrailでRoute53へのAPIリクエストをログに保存
  - セキュリティ分析
  - リソース変更の追跡
  - コンプライアンス監査
 
- タグ付けによる管理
  - ドメイン / ホストゾーン / ヘルスチェック
 
**料金**

- ホストゾーンあたり
  - 最初の25ホストゾーン $0.5
  - それを超えるホストゾーン $0.1o
- トラッフィクフロー
  - 1ポリシーレコードあたり $50ドル
  
  
  
