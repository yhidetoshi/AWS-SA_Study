# ELB

- ELB自体も負荷に応じてオートスケールする

- 複数のアベイラビリティゾーンに分散
  - DNSラウンドロビンで各AZのELBに振り分ける
  - 負荷が均等になるようにバックエンドのEC2に振り分ける
   
- 指定した設定に基づき、バックエンドのインスタンスのヘルスチェックを行える
- 課金は時間当たりの利用料と処理量の課金
- 独自ドメイン名でも利用可能
   - Route53を利用する場合はエイリアスレコードで登録(CNAMEの登録も可能)
   - Zone Apexの場合はCNAMEは設定不可。エイリアスレコードを利用する
- ELBのコネクションタイムアウト
  - 無通信状態が続くとそのコネクションを自動で切断する。
  - デフォルトのコネクションタイムアウトは60秒
  - コネクションタイムアウトは1 - 3600秒の間で自由に設定可能

- ELB自体のスケーリング
  - リクエストが瞬間的に急増し、スケーリングが間に合わない場合は HTTP 503を返す
  - 回避方法は事前にELBをスケールさせておく
     - Pre-Warmingの申請を行う
     - 段階的に負荷をかける

- Internet-Facing ELB / Internal ELB
  - Internet ELB: インターネットからアクセスできるELB
  - Internal ELB: VPC内やオンプレ環境からのみアクセスできればよい
- ELB自体にもセキュリティグループを設定可能

- スティッキーセッション
  - 同じユーザからきたリクエストを全て同じEC2インスタンスに送信
    - デフォルトでは無効、利用するために有効にする
    - アプリケーションでのセッション情報、一時ファイルなどをEC2インスタンスが保持する構成の場合に必要
    - HTTP/HTTPSでのみに利用可能
    - ELBは独自のセッションCookieを挿入
    - 有効期限は下記の２パターン
      - アプリケーション制御
      - 期間ベース
 
 - アクセスログのs3保管
   - ELBのアクセスログを指定したs3に自動保管
   
- AWS Certificate Manager(ACM)を使用して、証明書のリクエストと管理を容易に実施可能

- CloudWatchとの連携
 - 正常なバックエンドのホスト数
 - 異常なバックエンドホスト数
 - リクエスト数
 - 遅延時間
 - ELBが返した、4xx, 5xxのレスポンス数
 - バックエンドが返したリクエスト数
 - バックエンドへの送信保留中の件数
 - キュー溢れのため拒否した件数
